<?xml version="1.0" encoding="utf-8"?>
<mx:Window title="Janela de Vendas" xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" width="1024" 
	height="700" xmlns:utilidades="utilidades.*" closing="onCloseCommand(event)"
	keyDown="funcionalidades(event)" xmlns:inputs="utilidades.inputs.*">
	
	<mx:Script>
		<![CDATA[
			import utilidades.Util;
			import mx.events.ValidationResultEvent;
			import mx.controls.Alert;
			import mx.collections.ArrayCollection;
			import mx.events.CloseEvent;
			
			
			[Bindable]
			public var produtoLista:ArrayCollection = new ArrayCollection();
			
			[Bindable]
			public var isProduto:Boolean = false;
						
        	private function funcionalidades(event:KeyboardEvent):void{
        		switch(event.keyCode){
        			case 123: 
						this.stage.displayState = StageDisplayState.FULL_SCREEN;
        				break;
        			case 46:
        				if(event.ctrlKey){
	        				if(event.target == produtoGrid){ 
	        					if(this.produtoGrid.selectedIndex > -1){
	        						Alert.show("Deseja realmente deletar o item?",
	        							"Alerta",Alert.OK | Alert.CANCEL,this,removeItemArrayCollection,null,Alert.OK);
	        					}else{
	        						Alert.show("NÃ£o hÃ¡ item selecionado!"+"","",4,this);
	        					}							
	        				}
        				}
        				break;
        		}
        	}
        	
        	public function removeItemArrayCollection(event:CloseEvent):void{
        		if(event.detail == Alert.OK){
        			this.produtoLista.removeItemAt(this.produtoGrid.selectedIndex);
					if(this.produtoLista.length == 0){
							this.isProduto = false;
						}	
        		}
        		
        	}
			
			public function onCloseCommand(event:Event):void{
				if(isProduto){
					event.preventDefault();
					Alert.show("A janela nÃ£o pode ser fechada","Alerta",4,this);
				}				
   			}	
			
			
			public function inserirProduto():void{
				if(codV.validate().type == ValidationResultEvent.INVALID){
					focusManager.setFocus(codProduto);
					Alert.show("CÃ³digo Incorreto","Erro",4,this);
					return;
				}
				if(quantV.validate().type == ValidationResultEvent.INVALID){
					Alert.show("Quantidade Incorreta","Erro",4,this);
					focusManager.setFocus(quantProduto);
					return;
				}
              	this.produtoLista.addItem({codProduto:this.codProduto.text,quantidade:this.quantProduto.text});
				this.codProduto.text = "";
				this.quantProduto.text = "";
				focusManager.setFocus(codProduto);
				this.isProduto = true;
			}
			
			public function logoutUsuario():void{
				Util.abrePopUp(this,ComponenteAutenticacao,true);
			}
			
			public function orcamento():void{
				this.close();
			}	
			
			public function importarPedido():void{
			}			
		]]>
	</mx:Script>	
	
	<utilidades:ValidatorGenerico id="codPedidoV" required="true" source="{codPedido}" 
		msgErro="Código do Pedido Inválidoo. Digite apenas números"
		expRegular="{ValidatorGenerico.INTEIRO}" property="text"/>
	
	<utilidades:ValidatorGenerico id="codV" required="true" source="{codProduto}" 
		msgErro="Código do Produto Inválido. Digite apenas números"
		expRegular="{ValidatorGenerico.INTEIRO}" property="text"/>
		
	<utilidades:ValidatorGenerico id="quantV" required="true" source="{quantProduto}" 
		msgErro="Valor Inválido"
		expRegular="{ValidatorGenerico.VALOR}" property="text"/>	

	<mx:VBox id="body" width="100%" height="100%">
		<mx:HBox id="cabecalho" width="100%" height="43" fontWeight="bold">
			<mx:Label text="Cupom: " fontSize="30"/>
			<mx:Label id="numCupom" text="0001" fontSize="30" />
			<mx:Spacer width="50%"/>			
			<mx:Label text="UsuÃ¡rio:"/>
			<mx:Label text="Nome do UsuÃ¡rio" id="usuarioNome"/>		
			<mx:Button id="logout" label="Logout" click="logoutUsuario()"/>	
			<utilidades:RelogioDigital/>	
		</mx:HBox>
		<mx:VBox width="100%" height="100%">
			<mx:HBox>
				<mx:FormItem label="Importar Pedido" defaultButton="{impPedido}">
					<inputs:TextoInput id="codPedido" />
				</mx:FormItem>			
				<mx:Button id="impPedido" label="Imp Pedido" toolTip="Clique para importar um pedido" 
					click="{this.importarPedido()}"/>
				<mx:VBox width="100%" height="20%" horizontalAlign="right">
					<mx:Label text="Valor Total:" fontSize="20" fontWeight="bold"/>
					<mx:Label id="valorTotal" text="00,00" fontSize="60"/>
				</mx:VBox>	
			</mx:HBox>
			
			<mx:Form defaultButton="{inserir}">
				<mx:HBox id="produto" width="100%" height="40" fontSize="20" verticalAlign="middle">				
					<mx:FormItem label="CÃ³digo Produto">
						<inputs:TextoInput id="codProduto" />
					</mx:FormItem>	
					<mx:FormItem label="Quantidade" width="100%" height="100%">
						<inputs:TextoInput id="quantProduto"/>
					</mx:FormItem>
					<mx:Button id="inserir" label="Inserir" click="{inserirProduto()}" />
					<mx:Button id="buscarProdutos" label="Produtos" toolTip="Clique para procurar por um produto"/>
				</mx:HBox>
			</mx:Form>				
			<mx:DataGrid id="produtoGrid" width="100%" height="100%" dataProvider="{produtoLista}">
				<mx:columns>
					<mx:DataGridColumn headerText="Cod Prod." dataField="codProduto"/>
					<mx:DataGridColumn headerText="Quantidade" dataField="quantidade"/>					
				</mx:columns>
			</mx:DataGrid>
		</mx:VBox>		
		<mx:HBox id="rodape" width="100%" height="30">
			<mx:Button id="finalizarVenda" label="Finalizar" toolTip="Clique para finalizar venda" click="{orcamento()}"/>
			<mx:Button id="cancelarVenda" label="Cancelar" toolTip="Clique para cancelar venda"/>
		</mx:HBox>
	</mx:VBox>
</mx:Window>
